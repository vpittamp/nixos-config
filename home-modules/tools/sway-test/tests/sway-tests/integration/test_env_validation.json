{
  "name": "I3PM environment variables validation",
  "description": "Validates that apps launched via wrapper have correct I3PM_* environment variables set (I3PM_APP_NAME, I3PM_TARGET_WORKSPACE, I3PM_PROJECT_NAME)",
  "tags": ["integration", "environment", "i3pm"],
  "priority": "P2",
  "timeout": 20000,
  "actions": [
    {
      "type": "launch_app",
      "params": {
        "app_name": "alacritty",
        "project": "sway-test",
        "workspace": 7,
        "sync": true
      }
    },
    {
      "type": "wait_event",
      "params": {
        "event_type": "window",
        "timeout": 8000,
        "criteria": {
          "change": "new",
          "app_id": "Alacritty"
        }
      }
    },
    {
      "type": "await_sync",
      "params": {
        "marker": "alacritty_ready"
      }
    },
    {
      "type": "validate_environment",
      "params": {
        "app_name": "alacritty",
        "expected_vars": {
          "I3PM_APP_NAME": "alacritty",
          "I3PM_TARGET_WORKSPACE": "7",
          "I3PM_PROJECT_NAME": "sway-test"
        }
      }
    },
    {
      "type": "validate_workspace_assignment",
      "params": {
        "app_name": "alacritty",
        "expected_workspace": 7
      }
    }
  ],
  "expectedState": {
    "workspaces": [
      {
        "num": 7,
        "windows": [
          {
            "app_id": "Alacritty",
            "focused": true
          }
        ]
      }
    ],
    "focusedWorkspace": 7
  }
}
